# load compile stack
source /opt/intel/impi/5.0.3.048/intel64/bin/mpivars.sh
source /opt/intel/compiler/2015.5.223/bin/iccvars.sh intel64
source /opt/intel/mpss/3.5.37182/etc/mpss_vars.sh
export CXX=icpc
export CC=icc
export FC=ifort
export CFLAGS="-O3 -xHost"
export CXXFLAGS=$CFLAGS
export CPPFLAGS=$CFLAGS
export FCFLAGS=$CFLAGS

# target
base=/path/to/install/dir

# set environment
export PYTHONHOME=$base/python-2.7.10
export PYTHONPATH=$base/python-2.7.10/lib
export PATH=$base/python-2.7.10/bin:$PATH
export PYTHONPATH=$base/ase-3.9.1/lib:$PYTHONPATH
export PATH=$base/ase-3.9.1/bin:$PATH
export LIBXCDIR=$base/libxc-2.1.2
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$base/libxc-2.1.2/lib
export PYTHONPATH=$base/cython-0.23:$PYTHONPATH
export PATH=$base/cython-0.23/bin:$PATH

# pymic
tar xvfz src/pyMIC.tar.gz
sed -e "s|<TARGET>|$base/pymic|" setup/install-pymic.sh > pyMIC/install-pymic.sh
cd pyMIC
export PYTHON_INCLUDES="-I$PYTHONHOME/include/python2.7 -I$PYTHONHOME/lib/python2.7/site-packages/numpy/core/include"
source ./env.sh
make | tee loki-make
bash install-pymic.sh
cd ..

